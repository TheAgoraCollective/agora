---
import Layout from '../layouts/Layout.astro';
import ArticleList from '../components/ArticleList.svelte';
import { turso } from "../lib/turso";

const result = await turso.execute({
  sql: "SELECT id, slug, title, author_display_name, upvotes, downvotes, created_at FROM articles ORDER BY created_at DESC LIMIT 50",
  args: [],
});

const articles = result.rows.map(row => ({
    id: row.id as string,
    slug: row.slug as string,
    title: row.title as string,
    author_display_name: row.author_display_name as string,
    upvotes: row.upvotes as number,
    downvotes: row.downvotes as number,
    created_at: row.created_at as string,
}));
---

<Layout title="Agora - Anonymous University News">
	<h1 class="text-4xl font-bold mb-6 border-b border-gray-700 pb-2">
		Latest Posts
	</h1>
	
	<ArticleList articles={articles} />

</Layout>
